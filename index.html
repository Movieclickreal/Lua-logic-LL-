<!DOCTYPE html>
<html>
<head>
  <title>(LL) Lua Logic </title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background: linear-gradient(to bottom, #000033, #000066); 
      gap: 20px;
      padding: 20px;
      color: #ffffff; 
      flex-direction: column;
    }

    .container {
      background-color: rgba(255, 255, 255, 0.1); 
      padding: 30px 40px;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
      max-width: 1200px;
      width: 100%;
      display: flex;
      gap: 40px;
    }

    .code-area {
      flex: 2;
    }

    h1 {
      color: #ffffff;
      margin-bottom: 20px;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      font-size: 2.5em;
    }

    .code-input {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }

    .code-input textarea {
      padding: 15px;
      background-color: rgba(0, 0, 0, 0.7);
      border: 2px solid #007bff;
      border-radius: 8px;
      width: 100%;
      box-sizing: border-box;
      font-family: 'Courier New', monospace;
      resize: vertical;
      min-height: 200px;
      color: #ffffff;
      font-size: 1.1em;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
      white-space: pre-wrap; /* Preserve line breaks and spaces */
    }

    .code-input button {
      padding: 12px 20px;
      background: linear-gradient(to right, #007bff, #0056b3);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      align-self: center;
      width: 180px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .code-input button:hover {
      background: linear-gradient(to right, #0056b3, #007bff);
      transform: translateY(-3px);
    }

    #code-explanation {
      background-color: rgba(0, 0, 0, 0.7);
      border: 1px solid #007bff;
      border-radius: 8px;
      padding: 25px;
      white-space: pre-line;
      text-align: left;
      color: #ffffff;
      font-size: 1.1em;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      overflow-x: auto; /* Add horizontal scroll for long lines */
    }

    #code-explanation.loading {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 0.7;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: 0.7;
      }
    }

    .version {
      text-align: center;
      font-size: 0.9em;
      color: #ffffff;
      margin-top: 30px;
      position: relative;
    }

    .version::before {
      content: "";
      display: block;
      width: 100%;
      height: 1px;
      background-color: rgba(255, 255, 255, 0.2);
      position: absolute;
      top: -15px;
    }

    .sidebar {
      flex: 1;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      max-height: 600px; 
      overflow-y: auto; 
    }

    .sidebar h2 {
      color: #ffffff;
      margin-bottom: 15px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      font-size: 1.8em;
    }

    .sidebar code {
      display: block;
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 15px;
      font-family: 'Courier New', monospace;
      color: #ffffff;
      font-size: 1.05em;
      white-space: pre-wrap; 
    }

    /* Syntax Highlighting */
    .code-input textarea .keyword { 
      color: red; 
    }
    .code-input textarea .comment { 
      color: green; 
    }
    .code-input textarea .string { 
      color: blue; 
    }
    /* Add more styles for other token types as needed */

  </style>
</head>
<body>
  <div class="container">
    <div class="code-area">
      <h1>LL by movieclick</h1>
      <div class="code-input">
        <textarea id="lua-code">
-- Enter your Lua code here
        </textarea>
        <button id="explain-button">Explain</button>
      </div>
      <div id="code-explanation"></div>
      <div class="version">v1.6 (updated 10/24/24)</div> 
    </div>
    <div class="sidebar">
      <h2>Lua Code Examples</h2>
      
      <code>-- Variables</code>
      <code>local myVariable = 10</code>
      <code>local myString = "Hello"</code>

      <code>-- Printing</code>
      <code>print("Hello, world!")</code>
      <code>print(myVariable)</code>

      <code>-- Functions</code>
      <code>function greetPlayer(playerName)</code>
      <code>  print("Hello, " .. playerName)</code>
      <code>end</code>

      <code>-- Tables</code>
      <code>local inventory = {"Sword", "Shield", "Potion"}</code>
      <code>print(inventory[1]) -- Outputs "Sword"</code>

      <code>-- Control Structures</code>
      <code>-- If statement</code>
      <code>local health = 50</code>
      <code>if health &gt; 0 then </code> 
      <code>  print("Player is alive")</code>
      <code>else</code>
      <code>  print("Player is dead")</code>
      <code>end</code>

      <code>-- While loop</code>
      <code>local i = 1</code>
      <code>while i &lt;= 10 do</code>
      <code>  print(i)</code>
      <code>  i = i + 1</code>
      <code>end</code>

      <code>-- For loop</code>
      <code>for i = 1, 5 do</code>
      <code>  print(i)</code>
      <code>end</code>

      <code>-- Events</code>
      <code>local player = game.Players.LocalPlayer</code>
      <code>player.Chatted:Connect(function(message)</code>
      <code>  print(player.Name .. " said: " .. message)</code>
      <code>end)</code>

      <code>-- Object-Oriented Programming</code>
      <code>Player = {}</code>
      <code>Player.__index = Player</code>
      <code>function Player:new(name)</code>
      <code>  local instance = setmetatable({}, Player)</code>
      <code>  instance.name = name</code>
      <code>  return instance</code>
      <code>end</code>
      <code>function Player:greet()</code>
      <code>  print("Hello, " .. self.name)</code>
      <code>end</code>
      <code>local player1 = Player:new("Alex")</code>
      <code>player1:greet() -- Outputs "Hello, Alex"</code>

      <code>-- Modules</code>
      <code>-- ModuleScript in ServerScriptService</code>
      <code>local MyModule = {}</code>
      <code>function MyModule.greet()</code>
      <code>  print("Hello from the module!")</code>
      <code>end</code>
      <code>return MyModule</code>
      <code>-- In another script</code>
      <code>local MyModule = require(game.ServerScriptService.MyModule)</code>
      <code>MyModule.greet() -- Outputs "Hello from the module!"</code>
    </div>
  </div>

  <script>
    const explainButton = document.getElementById('explain-button');
const codeExplanation = document.getElementById('code-explanation');
const luaCodeInput = document.getElementById('lua-code');

// Custom Lua Parser
function parseLua(code) {
  const tokens = [];
  const variables = [];
  const functions = [];
  const functionCalls = [];
  const ifStatements = [];
  const loops = [];
  const comments = [];
  const strings = [];

  let currentToken = "";
  let inString = false;
  let inComment = false;
  let stringDelimiter = "";

  // Helper function to add a token and reset currentToken
  function addToken(token) {
    if (token !== "") {
      tokens.push(token);
      currentToken = "";
    }
  }

  for (let i = 0; i < code.length; i++) {
    const char = code[i];

    if (inString) {
      currentToken += char;
      if (char === stringDelimiter) {
        inString = false;
        addToken(currentToken);
        strings.push(currentToken);
      }
    } else if (inComment) {
      if (char === "\n") {
        inComment = false;
        comments.push(currentToken);
        currentToken = "";
      } else {
        currentToken += char;
      }
    } else {
      if (char === '"' || char === "'") {
        inString = true;
        stringDelimiter = char;
        currentToken += char;
      } else if (char === "-" && code[i + 1] === "-") {
        inComment = true;
        addToken(currentToken); // Add any token before the comment
        currentToken = "--";
        i++;
      } else if (/\s/.test(char)) {
        addToken(currentToken);
      } else {
        currentToken += char;
      }
    }
  }

  addToken(currentToken); // Add the last token

  // Improved code analysis
  for (let i = 0; i < tokens.length; i++) {
    const token = tokens[i];
    if (token === "local" && tokens[i + 1] && tokens[i + 2] === "=") {
      variables.push({ name: tokens[i + 1], type: "local" });
    } else if (token === "function" && tokens[i + 1] && tokens[i + 2] === "(") {
      let functionName = tokens[i + 1];
      let params = "";
      let parenCount = 1;
      i += 3; // Move to the first parameter (or ')' if no parameters)
      while (i < tokens.length && parenCount > 0) {
        if (tokens[i] === "(") parenCount++;
        if (tokens[i] === ")") parenCount--;
        if (parenCount > 0) params += tokens[i] + " ";
        i++;
      }
      functions.push({ name: functionName, params: params.trim() });
    } else if (token.match(/^[a-zA-Z0-9_.]+\s*\(.*\)$/)) {
      functionCalls.push(token.split('(')[0].trim());
    } else if (token === "if") {
      ifStatements.push(token);
    } else if (token === "for" || token === "while") {
      loops.push(token);
    }
  }

  return { tokens, variables, functions, functionCalls, ifStatements, loops, comments, strings };
}

// Auto-completion
luaCodeInput.addEventListener('keydown', (event) => {
  const code = luaCodeInput.value;
  const cursorPos = luaCodeInput.selectionStart;

  const openChars = ['(', '{', '[', '"', "'"];
  const closeChars = [')', '}', ']', '"', "'"];
  const keywords = ["if", "then", "else", "elseif", "end", "function", "local", "for", "while", "do", "repeat", "until", "return"];

  let insertText = "";
  let moveCursor = 0;

  if (openChars.includes(event.key)) {
    insertText = event.key + closeChars[openChars.indexOf(event.key)];
    moveCursor = 1;
  } else if (keywords.includes(event.key)) {
    insertText = event.key + " ";
  } else if (event.key === "Tab") {
    event.preventDefault();
    insertText = "  ";
  }

  // Context-aware auto-completion
  const currentLine = code.substring(0, cursorPos).split("\n").pop();
  if (currentLine.trim().startsWith("if") && event.key === "Enter") {
    insertText += "then\n  \nend";
    moveCursor = 5;
  } else if (currentLine.trim().startsWith("function") && event.key === "Enter") {
    insertText += "\n  \nend";
    moveCursor = 3;
  } else if (currentLine.trim().startsWith("for") && event.key === "Enter") {
    insertText += "\ndo\n  \nend";
    moveCursor = 3;
  } else if (currentLine.trim().startsWith("while") && event.key === "Enter") {
    insertText += "\ndo\n  \nend";
    moveCursor = 3;
  }

  if (insertText) {
    event.preventDefault();
    luaCodeInput.value = code.substring(0, cursorPos) + insertText + code.substring(cursorPos);
    luaCodeInput.selectionStart = luaCodeInput.selectionEnd = cursorPos + moveCursor;
  }
});

// Explain button click handler
explainButton.addEventListener('click', () => {
  const luaCode = luaCodeInput.value.trim();
  codeExplanation.innerHTML = "";
  codeExplanation.classList.add("loading");

  // Simulate asynchronous parsing (for demonstration)
  setTimeout(() => {
    codeExplanation.classList.remove("loading");
    try {
      const parsedCode = parseLua(luaCode);
      let explanation = explainCode(parsedCode);
      codeExplanation.innerHTML = explanation;
    } catch (error) {
      codeExplanation.innerHTML = "Error parsing Lua code: " + error.message;
    }
  }, 500);
});

// Function to generate explanations based on parsed code
function explainCode(parsedCode) {
  let explanation = "";

  // Example explanations (can be significantly improved)
  if (parsedCode.functionCalls.includes("print")) {
    explanation += "<p>This code uses the <code>print()</code> function to display output to the console. This is helpful for debugging and showing information.</p>";
  }

  if (parsedCode.functions.length > 0) {
    explanation += "<p>This code defines the following function(s): ";
    parsedCode.functions.forEach(func => {
      explanation += `<code>${func.name}(${func.params})</code> `;
    });
    explanation += ". Functions are reusable blocks of code that can perform specific tasks.</p>";
  }

  if (parsedCode.variables.length > 0) {
    explanation += "<p>This code defines the following variable(s): ";
    parsedCode.variables.forEach(variable => {
      explanation += `<code>${variable.name}</code> (${variable.type}) `;
    });
    explanation += ". Variables are used to store data.</p>";
  }

  if (parsedCode.ifStatements.length > 0) {
    explanation += "<p>This code uses <code>if</code> statements to make decisions. It executes a block of code only if a certain condition is true.</p>";
  }

  if (parsedCode.loops.includes("for")) {
    explanation += "<p>This code uses a <code>for</code> loop to repeat a block of code a specific number of times.</p>";
  }

  if (parsedCode.loops.includes("while")) {
    explanation += "<p>This code uses a <code>while</code> loop to repeat a block of code as long as a condition is true.</p>";
  }

  // Add more explanations based on parsedCode.tokens, parsedCode.variables, etc.
  if (parsedCode.comments.length > 0) {
    explanation += "<p>This code includes comments (lines starting with '--') to explain the code to humans. Comments are ignored by the computer.</p>";
  }

  if (parsedCode.strings.length > 0) {
    explanation += "<p>This code uses string literals (text enclosed in quotes) to represent text data.</p>";
  }

  if (explanation === "") {
    explanation = "<p>I'm still learning to understand Lua code. Try entering some basic code, and I'll do my best to explain it!</p>";
  }

  return explanation;
}

// Real-time feedback with syntax highlighting
luaCodeInput.addEventListener('input', () => {
  const luaCode = luaCodeInput.value;

  try {
    const parsedCode = parseLua(luaCode);

    // Highlight code
    let highlightedCode = "";
    let lastIndex = 0;
    for (let i = 0; i < parsedCode.tokens.length; i++) {
      const token = parsedCode.tokens[i];
      const tokenIndex = luaCode.indexOf(token, lastIndex);

      highlightedCode += luaCode.substring(lastIndex, tokenIndex);

      if (token === "local") {
        highlightedCode += `<span class="keyword">${token}</span>`;
      } else if (token.startsWith("--")) {
        highlightedCode += `<span class="comment">${token}</span>`;
      } else if (token.startsWith('"') || token.startsWith("'")) {
        highlightedCode += `<span class="string">${token}</span>`;
      } else {
        highlightedCode += token;
      }

      lastIndex = tokenIndex + token.length;
    }

    highlightedCode += luaCode.substring(lastIndex);

    // Update the code area with highlighted code and explanation
    codeExplanation.innerHTML = highlightedCode;

    // Generate and display the explanation
    let explanation = explainCode(parsedCode);
    codeExplanation.innerHTML += `<div id="explanation">${explanation}</div>`; // Add explanation

  } catch (error) {
    codeExplanation.innerHTML = "Error parsing Lua code.";
  }
});
  </script>
</body>
</html>
